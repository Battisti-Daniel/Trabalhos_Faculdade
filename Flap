/*Versão beta desenvolvida por Thiago Felski Pereira para disciplina de Algoritmos*/
#include <iostream>
#include <windows.h>
#include <conio.h> ///para o getch()
#include <time.h>
///https://stackoverflow.com/questions/34474627/linux-equivalent-for-conio-h-getch

using namespace std;


/**
    F L A P B I R D (M2 Algoritmos)
    - Lembrando: não permitido o uso de funções e variáveis compostas como structs, vetores e matrizes
    - Corrigir os rastros (pássaro e obstáculos)
    - Implementar colisão
    - Implementar pontuação (mais um ponto para cada obstáculo superado)
    - Fazer 2 obstáculos simultâneos (obstaculo1 e obstaculo2)
    - Deixar a pontuação visível durante todo o jogo
    - Definir marcos para acelerar a velocidade
*/



int main()
{
    ///ALERTA: NÃO MODIFICAR O TRECHO DE CÓDIGO, A SEGUIR.
    //INICIO: COMANDOS PARA QUE O CURSOR NÃO FIQUE PISCANDO NA TELA
    HANDLE out = GetStdHandle(STD_OUTPUT_HANDLE);
    CONSOLE_CURSOR_INFO     cursorInfo;
    GetConsoleCursorInfo(out, &cursorInfo);
    cursorInfo.bVisible = false; // set the cursor visibility
    SetConsoleCursorInfo(out, &cursorInfo);
    //FIM: COMANDOS PARA QUE O CURSOR NÃO FIQUE PISCANDO NA TELA
    //INÍCIO: COMANDOS PARA REPOSICIONAR O CURSOR NO INÍCIO DA TELA
    COORD coord;
    //FIM: COMANDOS PARA REPOSICIONAR O CURSOR NO INÍCIO DA TELA
    ///ALERTA: NÃO MODIFICAR O TRECHO DE CÓDIGO, ACIMA.


    int bird_x = 5, bird_y = 10, ax, ay, placar = 0, remx, eh_barreira,x;
    int obstaculo_x = 80, obstaculo_y;
    int tecla{};

    ///DESENHO DO CENÁRIO
    cout << "--------------------------------------------------------------------------------------------------------";
    cout << "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n";
    cout << "--------------------------------------------------------------------------------------------------------\n";

    while (true) { //esse laço faz o jogo rodar para sempre

        ///POSICIONA O PÁSSARO
        coord.X = bird_x;    coord.Y = bird_y;
        SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), coord);
        cout << char(190);
        ax = bird_x;
        ay = bird_y;



        ///POSICIONA O OBSTÁCULO
        obstaculo_y = 1;
        while (obstaculo_y < 20) {
            coord.X = obstaculo_x;    coord.Y = obstaculo_y;
            SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), coord);
            if (obstaculo_y < 3 || obstaculo_y>11) {
                cout << char(219);
            }
            else {
                cout << " ";
            }
            obstaculo_y++;
        }

        cout << "\n";
        cout << "\n";
        cout << "Placar:" << placar;



        ///VERIFICA COLISÃO

        ///VERIFICA COMANDO DO JOGADOR
        if (_kbhit()) { ///verifica se uma tecla foi pressionada
            tecla = _getch(); //verifica comando do jogador
        }


        ///PÁSSARO CAI 1 POSIÇÃO SE NÃO FOI PRESSIONADO PARA SUBIR
        if (tecla == 'w') {
            bird_y--;
            tecla = '0';
        }
        else {
            bird_y++;
        }
        remx = obstaculo_x;


        ///OBSTÁCULO AVANÇA UMA POSIÇÃO PARA ESQUERDA
        obstaculo_x--;



        ///TEMPO DE ESPERA
        Sleep(200);

        //remove
        coord.X = ax;
        coord.Y = ay;
        SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), coord);
        cout << " ";

        obstaculo_y = 1;
        while (obstaculo_y < 20) {
            coord.X = remx;    coord.Y = obstaculo_y;
            SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), coord);
            cout << " ";
            obstaculo_y++;
        }
        
        if (obstaculo_x == bird_x) {
            obstaculo_x = NULL;
            obstaculo_y = NULL;
        }




        //GameOver
        if (ay < 1 or ay > 19 or (bird_y <= 2 and obstaculo_x == bird_x ) or (bird_y >= 11 and obstaculo_x == bird_x)) {

            return false;
        }
        else {
            placar += 1;
            srand(time(NULL));
            cout << rand()%100;
        }
    }

    return 0;
}
